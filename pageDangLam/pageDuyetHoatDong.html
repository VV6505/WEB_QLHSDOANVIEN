<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Ho·∫°t ƒê·ªông (Duy·ªát)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* ================================================= */
        /* 1. KHAI B√ÅO BI·∫æN & T√îNG M√ÄU CH·ª¶ ƒê·∫†O (BLUE) */
        /* ================================================= */
        :root {
            --primary-color: #3782f5; 
            --primary-dark: #2563eb;  
            --primary-light: #f0f8ff; 
            --text-dark: #1f2937;
            --text-gray: #62666f;
            --success-color: #10b981; 
            --danger-color: #ef4444; 
            --warning-color: #f59e0b; 
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: white; 
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex-grow: 1;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* ================================================= */
        /* 2. HEADER & NAVIGATION (Gi·ªØ nguy√™n) */
        /* ================================================= */

        .header-top {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.25rem 4rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 12px; 
        }

        .header-logo-icon {
            width: 48px; 
            height: 48px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .header-logo-icon i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .header-logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }
        .header-logo p {
            margin: 0;
            font-size: 0.875rem;
            color: #bfdbfe; 
        }

        .header-user-btn {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-left: 10px;

        }

        /* Breadcrumb */
        .breadcrumb {
            font-size: 0.9rem;
            color: var(--primary-color); 
            margin-bottom: 25px;
        }
        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .breadcrumb span.current {
            font-weight: 600;
        }
        
        /* Footer */
        .footer {
            background-color: #3782f5; 
            border-top: 1px solid #bfdbfe; 
            margin-top: auto; 
            text-align: center;
            padding: 1rem;
            font-size: 0.875rem;
            color: var(--primary-light);
        }

        /* ================================================= */
        /* 3. TABS & LISTS (S·ª≠a l·ªói b·ªë c·ª•c) */
        /* ================================================= */

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab-buttons button {
            flex: 1;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-size: 1rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tab-active {
            background-color: var(--primary-color);
            color: white;
        }

        .tab-inactive {
            background-color: white;
            color: var(--text-dark);
        }
        .tab-inactive:hover {
            background-color: var(--primary-light);
        }

        .activity-item {
            border: 1px solid #bfdbfe; 
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: box-shadow 0.2s;
            padding: 24px;
            margin-bottom: 16px;
        }
        .activity-item:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center; /* CƒÉn ch·ªânh ti√™u ƒë·ªÅ v√† tr·∫°ng th√°i */
            margin-bottom: 10px;
        }
        
        .item-status {
            padding: 2px 10px; /* Gi·∫£m padding */
            border-radius: 6px; 
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px; /* Kho·∫£ng c√°ch v·ªõi t√™n ho·∫°t ƒë·ªông */
        }
        
        /* C·∫ßn thi·∫øt l·∫≠p display flex cho ti√™u ƒë·ªÅ ƒë·ªÉ cƒÉn ch·ªânh T√™n v√† Tr·∫°ng th√°i */
        .item-title-group {
            display: flex;
            align-items: center;
            flex-wrap: wrap; /* Cho ph√©p xu·ªëng d√≤ng tr√™n mobile */
        }

        .status-pending { background-color: #fffbeb; color: #b45309; } 

        /* S·ª¨A L·ªñI B·ªê C·ª§C: ƒê·∫£m b·∫£o chi ti·∫øt l√† 2 c·ªôt ch√≠nh */
        .item-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px 20px; /* Kho·∫£ng c√°ch gi·ªØa c√°c chi ti·∫øt */
            font-size: 0.9rem;
            color: var(--text-gray);
            margin-bottom: 15px;
        }
        
        .item-detail-box {
            display: flex;
            align-items: center;
            gap: 8px;
            /* ƒê·∫£m b·∫£o m·ªói box ch·ªâ chi·∫øm 1 d√≤ng */
        }
        .item-detail-box i {
            width: 1rem;
            height: 1rem;
            color: var(--primary-color);
            flex-shrink: 0;
        }

        /* S·ª¨A L·ªñI B·ªê C·ª§C: CƒÉn ch·ªânh n√∫t */
        .item-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            align-items: stretch; /* ƒê·∫£m b·∫£o c√°c n√∫t c√πng chi·ªÅu cao */

        }

        .btn-view { 
            background-color: var(--primary-color); 
            color: white;
            padding: 10px 16px; 
            font-size: 0.95rem;
            flex-grow: 2; /* N√∫t ch√≠nh chi·∫øm kh√¥ng gian l·ªõn h∆°n */
            border-radius: 8px;
        }
        
        .btn-reject { 
            background-color: var(--danger-color); 
            color: white;
            padding: 10px 16px;
            font-size: 0.95rem;
            flex-grow: 1; /* N√∫t ph·ª• chi·∫øm kh√¥ng gian nh·ªè h∆°n */
            border-radius: 8px;
        }
        
        /* ================================================= */
        /* 4. MODAL/DETAIL VIEW (Gi·ªØ nguy√™n) */
        /* ================================================= */
        
        .detail-view {
            margin-top: 40px;
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 32px;
        }
        
        .detail-view-header {
            border-bottom: 1px solid #bfdbfe;
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .detail-view-header h3 {
            color: var(--primary-color);
        }

        .participants-table thead {
            background-color: var(--primary-light); 
            color: var(--primary-color);
        }
        
        .participants-table th, .participants-table td {
            padding: 10px;
            text-align: left;
            border-top: 1px solid #f3f4f6; 
        }

        .detail-view-footer {
            display: flex; /* B·ªë c·ª•c cho n√∫t */
            justify-content: flex-end; /* ƒê·∫©y n√∫t v·ªÅ b√™n ph·∫£i */
            gap: 12px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #bfdbfe; /* T·∫°o ƒë∆∞·ªùng ph√¢n c√°ch */
        }

        /* üî¥ N√öT DUY·ªÜT TO√ÄN B·ªò SINH VI√äN */
        .detail-view-footer button {
            padding: 12px 20px; /* TƒÉng padding ƒë·ªÉ n√∫t to h∆°n */
            border: none;
            border-radius: 10px; /* TƒÉng border-radius cho bo tr√≤n ƒë·∫πp h∆°n */
            cursor: pointer;
            font-size: 1.05rem; /* TƒÉng c·ª° ch·ªØ */
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .detail-view-footer button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
        }


        .detail-view-footer .btn-full-approve { 
            background-color: var(--success-color); /* M√†u xanh l√° c√¢y */
            color: white; 
            /* ƒê·∫£m b·∫£o style to v√† bo tr√≤n ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng t·ª´ button chung */
        }

        .detail-view-footer .btn-close { 
            background-color: var(--text-gray); /* M√†u x√°m */
            color: white; 
        }

        /* S·ª≠a l·∫°i b·ªë c·ª•c cho mobile: chuy·ªÉn v·ªÅ d·ªçc */
        @media (max-width: 767px) {
            .detail-view-footer { 
                flex-direction: column; 
                gap: 10px; 
                justify-content: flex-start; /* Reset v·ªÅ tr√°i tr√™n mobile */
            }
        }

        /* ================================================= */
        /* 5. MEDIA QUERIES (RESPONSIVE) */
        /* ================================================= */

        /* Tablet Screens (<= 1023px) */
        @media (max-width: 1023px) {
            .header-top { padding: 1rem 20px; }
            .container { padding: 15px; }
            /* V·∫´n gi·ªØ 2 c·ªôt ch√≠nh cho item-details */
        }

        /* Mobile Screens (<= 767px) */
        @media (max-width: 767px) {
            .header-top { padding: 1rem 15px; }
            .header-content { flex-direction: column; align-items: center; gap: 10px; }
            .header-logo { text-align: center; flex-direction: column; gap: 5px; }
            .header-logo-icon { width: 40px; height: 40px; }
            .header-logo-icon i { font-size: 1.2rem; }
            .header-logo h1 { font-size: 1.2rem; }
            .header-logo p { font-size: 0.75rem; }
            
            .tab-buttons { flex-direction: column; }
            
            .item-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            
            /* Chi ti·∫øt chuy·ªÉn v·ªÅ 1 c·ªôt */
            .item-details { grid-template-columns: 1fr; }
            
            /* N√∫t h√†nh ƒë·ªông chuy·ªÉn v·ªÅ b·ªë c·ª•c d·ªçc */
            .item-actions { flex-direction: column; }
            .btn-view, .btn-reject { flex-grow: 1; width: 100%; }

            .participants-table { display: block; overflow-x: auto; white-space: nowrap; }
            .detail-view { padding: 20px 15px; }
            .detail-view-footer { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <header class="header-top">
        <div class="container header-content">
            <div class="header-logo">
                <div class="header-logo-icon">
                    <i class="fa-solid fa-square-check"></i>
                </div>
                <div>
                    <h1>Qu·∫£n L√Ω Ho·∫°t ƒê·ªông</h1>
                    <p>Ho·∫°t ƒë·ªông - Khoa C√¥ng Ngh·ªá S·ªë</p>
                </div>
            </div>
            <div class="header-user">
                <span style="font-size:0.9rem;">üë§ B√≠ th∆∞ Khoa CNS</span>
                <button class="header-user-btn">
                    ƒêƒÉng xu·∫•t
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="breadcrumb">
            <a href="#">Trang ch·ªß</a>
            <span class="mx-2">/</span>
            <span class="current">Qu·∫£n l√Ω ho·∫°t ƒë·ªông</span>
        </div>

        <div class="tab-buttons">
            <button id="tabKhoa">
                üéØ Ho·∫°t ƒë·ªông c·ªßa Khoa (<span id="countKhoa"></span>)
            </button>
            <button id="tabTruong">
                üè´ Ho·∫°t ƒë·ªông ƒêo√†n Tr∆∞·ªùng (<span id="countTruong"></span>)
            </button>
        </div>

        <div id="activityList" class="space-y-4">
            <!-- Danh s√°ch ho·∫°t ƒë·ªông s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </div>


        <div id="detailView" class="detail-view" style="display: none;">
            <!-- Chi ti·∫øt ho·∫°t ƒë·ªông s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </div>
    </main>

    <footer class="footer">
        ¬© 2025 H·ªá th·ªëng Qu·∫£n l√Ω ƒêo√†n vi√™n - ƒêHSPKT | Nh√≥m 37
    </footer>

    <script>
        // üí° CH√ö TH√çCH REACT: ƒê√¢y l√† object m√¥ ph·ªèng React State
        let state = {
          activeTab: 'khoa', // activeTab
          activities: [ // activities
              { id: 1, name: 'H·ªôi th·∫£o Kh·ªüi nghi·ªáp 2024', type: 'khoa', khoa: 'CNTT', date: '2025-11-15', time: '14:00 - 16:00', location: 'H·ªôi tr∆∞·ªùng B', status: 'pending', participants: 25, maxParticipants: 50, organizer: 'Khoa C√¥ng Ngh·ªá S·ªë', description: 'H·ªôi th·∫£o chia s·∫ª kinh nghi·ªám kh·ªüi nghi·ªáp cho sinh vi√™n', score: 3 },
              { id: 2, name: 'Ch∆∞∆°ng tr√¨nh Hi·∫øn m√°u nh√¢n ƒë·∫°o', type: 'truong', khoa: 'ƒêo√†n tr∆∞·ªùng', date: '2025-11-20', time: '08:00 - 12:00', location: 'S·∫£nh A', status: 'approved', participants: 120, maxParticipants: 200, organizer: 'ƒêo√†n tr∆∞·ªùng ƒêHSPKT', description: 'Ch∆∞∆°ng tr√¨nh hi·∫øn m√°u t√¨nh nguy·ªán', score: 1 },
              { id: 3, name: 'Ng√†y h·ªôi Vi·ªác l√†m - Job Fair', type: 'khoa', khoa: 'CNTT', date: '2025-11-25', time: '09:00 - 17:00', location: 'S·∫£nh A', status: 'approved', participants: 15, maxParticipants: 100, organizer: 'Khoa C√¥ng Ngh·ªá S·ªë', description: 'K·∫øt n·ªëi sinh vi√™n v·ªõi doanh nghi·ªáp', score: 2 }, 
              { id: 4, name: 'Gi·∫£i b√≥ng ƒë√° mini', type: 'khoa', khoa: 'CNTT', date: '2025-12-01', time: '16:00', location: 'S√¢n v·∫≠n ƒë·ªông', status: 'rejected', participants: 30, maxParticipants: 30, organizer: 'Khoa C√¥ng Ngh·ªá S·ªë', description: 'Gi·∫£i ƒë·∫•u giao h·ªØu', score: 1 },
              { id: 5, name: 'Workshop L·∫≠p tr√¨nh Python c∆° b·∫£n', type: 'khoa', khoa: 'CNTT', date: '2025-12-10', time: '18:00 - 20:00', location: 'Ph√≤ng Lab 203', status: 'approved', participants: 5, maxParticipants: 40, organizer: 'CLB L·∫≠p tr√¨nh', description: 'N√¢ng cao ki·∫øn th·ª©c l·∫≠p tr√¨nh Python cho ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu.', score: 3 },
              { id: 6, name: 'T·ªça ƒë√†m VƒÉn h√≥a Doanh nghi·ªáp', type: 'khoa', khoa: 'CNTT', date: '2025-12-15', time: '09:00 - 11:30', location: 'Ph√≤ng H·ªôi th·∫£o A', status: 'approved', participants: 8, maxParticipants: 60, organizer: 'Khoa C√¥ng Ngh·ªá S·ªë', description: 'T√¨m hi·ªÉu v·ªÅ vƒÉn h√≥a, m√¥i tr∆∞·ªùng l√†m vi·ªác t·∫°i c√°c c√¥ng ty IT.', score: 2 },
              { id: 7, name: 'Tham quan C√¥ng ty C√¥ng ngh·ªá FPT', type: 'khoa', khoa: 'CNTT', date: '2026-01-05', time: '07:30', location: 'KCN Cao', status: 'pending', participants: 45, maxParticipants: 50, organizer: 'Ph√≤ng Quan h·ªá Doanh nghi·ªáp', description: 'Chuy·∫øn ƒëi th·ª±c t·∫ø t·∫°i c√°c c√¥ng ty c√¥ng ngh·ªá h√†ng ƒë·∫ßu.', score: 5 },
              { id: 8, name: 'H·ªôi tr·∫°i K·ªπ nƒÉng ƒêo√†n vi√™n 2026', type: 'truong', khoa: 'ƒêo√†n tr∆∞·ªùng', date: '2026-01-15', time: 'C·∫£ ng√†y', location: 'Khu du l·ªãch Su·ªëi Ti√™n', status: 'approved', participants: 300, maxParticipants: 500, organizer: 'ƒêo√†n tr∆∞·ªùng ƒêHSPKT', description: 'R√®n luy·ªán k·ªπ nƒÉng m·ªÅm v√† tinh th·∫ßn ƒë·ªìng ƒë·ªôi.', score: 5 },
              { id: 9, name: 'H·ªôi thi Ti·∫øng h√°t Sinh vi√™n', type: 'truong', khoa: 'ƒêo√†n tr∆∞·ªùng', date: '2026-01-25', time: '19:00', location: 'H·ªôi tr∆∞·ªùng L·ªõn', status: 'pending', participants: 150, maxParticipants: 300, organizer: 'ƒêo√†n tr∆∞·ªùng ƒêHSPKT', description: 'S√¢n ch∆°i √¢m nh·∫°c cho sinh vi√™n to√†n tr∆∞·ªùng.', score: 3 },
              { id: 10, name: 'B·∫£o v·ªá M√¥i tr∆∞·ªùng - V√¨ m·ªôt Vi·ªát Nam Xanh', type: 'khoa', khoa: 'CNTT', date: '2026-02-10', time: '07:00 - 11:00', location: 'C√¥ng vi√™n A', status: 'pending', participants: 25, maxParticipants: 100, organizer: 'CLB T√¨nh nguy·ªán', description: 'Ch∆∞∆°ng tr√¨nh nh·∫∑t r√°c v√† tr·ªìng c√¢y g√¢y qu·ªπ.', score: 5 }
          ],
          selectedActivity: null, 
          participantsList: [ // M·∫´u, c·∫ßn ph·∫£i ƒë∆∞·ª£c l·ªçc theo ActivityId th·ª±c t·∫ø
              { id: 1, mssv: 'SV001', name: 'Nguy·ªÖn VƒÉn A', class: '22IT1', status: 'pending', activityId: 1, proofUrl: 'https://storage.google.com/proofs/hthk_sv001.jpg' },
              { id: 2, mssv: 'SV002', name: 'Tr·∫ßn Th·ªã B', class: '22IT2', status: 'pending', activityId: 3, proofUrl: 'https://storage.google.com/proofs/jf_sv002.pdf' }, 
              { id: 3, mssv: 'SV003', name: 'L√™ VƒÉn C', class: '22IT1', status: 'pending', activityId: 2, proofUrl: '' }, // Ho·∫°t ƒë·ªông tr∆∞·ªùng kh√¥ng c·∫ßn minh ch·ª©ng trong m·∫´u
              { id: 4, mssv: 'SV004', name: 'Ph·∫°m D', class: '22IT1', status: 'pending', activityId: 3, proofUrl: 'https://storage.google.com/proofs/jf_sv004.jpg' }, 
              { id: 5, mssv: 'SV005', name: 'Nguy·ªÖn Th·ªã E', class: '22IT3', status: 'pending', activityId: 5, proofUrl: 'https://storage.google.com/proofs/py_sv005.png' }, 
              { id: 6, mssv: 'SV006', name: 'Tr·∫ßn VƒÉn F', class: '22IT2', status: 'pending', activityId: 5, proofUrl: '' }, // Kh√¥ng c√≥ minh ch·ª©ng
              { id: 7, mssv: 'SV007', name: 'Ph·∫°m Th·ªã G', class: '22IT3', status: 'pending', activityId: 6, proofUrl: 'https://storage.google.com/proofs/vn_sv007.pdf' }, 
              { id: 8, mssv: 'SV008', name: 'L√™ H·ªØu H', class: '22IT4', status: 'pending', activityId: 6, proofUrl: '' }, 
              { id: 9, mssv: 'SV009', name: 'Hu·ª≥nh T', class: '22IT1', status: 'pending', activityId: 6, proofUrl: 'https://storage.google.com/proofs/vn_sv009.jpg' }, 
              { id: 10, mssv: 'SV010', name: 'ƒêo√†n X', class: '23IT1', status: 'pending', activityId: 7, proofUrl: 'https://storage.google.com/proofs/fpt_sv010.jpg' }, 
              { id: 11, mssv: 'SV011', name: 'V≈© Y', class: '23IT2', status: 'pending', activityId: 7, proofUrl: '' }, 
              { id: 12, mssv: 'SV012', name: 'Tr·∫ßn A', class: '23IT1', status: 'pending', activityId: 8, proofUrl: '' }, 
              { id: 13, mssv: 'SV013', name: 'Nguy·ªÖn B', class: '22IT1', status: 'pending', activityId: 10, proofUrl: 'https://storage.google.com/proofs/mt_sv013.jpg' }
          ],
          // M√¥ ph·ªèng ƒëi·ªÉm t√≠ch l≈©y t·ªïng c·ªßa sinh vi√™n
          studentScores: { 'SV002': 10, 'SV004': 5 }
      };

      // Elements (Refs)
      const elements = {
          activityList: document.getElementById('activityList'),
          detailView: document.getElementById('detailView'),
          tabKhoa: document.getElementById('tabKhoa'),
          tabTruong: document.getElementById('tabTruong'),
          countKhoa: document.getElementById('countKhoa'),
          countTruong: document.getElementById('countTruong')
      };

      // ------------------------------------------------
      // üí° CH√ö TH√çCH REACT: H√†m c·∫≠p nh·∫≠t UI (Re-render)
      function updateUI() {
          // 1. C·∫≠p nh·∫≠t Tabs
          elements.tabKhoa.className = state.activeTab === 'khoa' ? 'tab-active' : 'tab-inactive';
          elements.tabTruong.className = state.activeTab === 'truong' ? 'tab-active' : 'tab-inactive';

          const countKhoa = state.activities.filter(a => a.type === 'khoa').length;
          const countTruong = state.activities.filter(a => a.type === 'truong').length;
          elements.countKhoa.textContent = countKhoa;
          elements.countTruong.textContent = countTruong;


          // 2. L·ªçc danh s√°ch Ho·∫°t ƒë·ªông
          const filteredActivities = state.activities.filter(a => 
              state.activeTab === 'khoa' ? a.type === 'khoa' : a.type === 'truong'
          );

          // 3. Render danh s√°ch Ho·∫°t ƒë·ªông
          elements.activityList.innerHTML = filteredActivities.map(activity => {
              let statusClass, statusText;
              switch (activity.status) {
                  case 'approved': statusClass = 'status-approved'; statusText = '‚úì ƒê√£ duy·ªát'; break;
                  case 'rejected': statusClass = 'status-rejected'; statusText = '‚úó ƒê√£ h·ªßy ho·∫°t ƒë·ªông'; break;
                  default: statusClass = 'status-pending'; statusText = '‚è≥ Ch·ªù duy·ªát'; break;
              }

              let actionButtonsHTML;
              if (activity.type === 'truong') {
                  // HO·∫†T ƒê·ªòNG TR∆Ø·ªúNG: CH·ªà XEM
                  actionButtonsHTML = `
                      <button class="btn-view" style="flex: 2;" onclick="handleViewDetail(${activity.id})">
                          <i class="fa-solid fa-eye"></i> Xem chi ti·∫øt
                      </button>`;
              } else if (activity.status === 'approved' && activity.type === 'khoa') {
                  // HO·∫†T ƒê·ªòNG KHOA ƒê√É DUY·ªÜT: QU·∫¢N L√ù T·ª™NG SINH VI√äN
                  actionButtonsHTML = `
                      <button class="btn-view" style="flex: 2; " onclick="handleViewDetail(${activity.id})">
                          <i class="fa-solid fa-user-check"></i> Qu·∫£n l√Ω danh s√°ch
                      </button>`;
              } else if (activity.status === 'pending' && activity.type === 'khoa') {
                  // HO·∫†T ƒê·ªòNG KHOA CH·ªú DUY·ªÜT: CH·ªà C√ì N√öT H·ªßy ho·∫°t ƒë·ªông (H·ªßy ho·∫°t ƒë·ªông ƒë·ªÅ xu·∫•t)
                  actionButtonsHTML = `
                      <button class="btn-view" disabled style="flex: 2; background-color: #ccc; cursor: not-allowed; opacity: 0.7;">
                          <i class="fa-solid fa-hourglass-half"></i> Ch·ªù x√©t duy·ªát
                      </button>
                      <button class="btn-reject" style="flex: 1;" onclick="handleRejectActivity(${activity.id})">
                          <i class="fa-solid fa-xmark"></i> H·ªßy ho·∫°t ƒë·ªông
                      </button>`;
              } else {
                  // Ho·∫°t ƒë·ªông ƒë√£ b·ªã H·ªßy ho·∫°t ƒë·ªông
                  actionButtonsHTML = `
                      <button class="btn-view" disabled style="flex: 2; background-color: #ccc; cursor: not-allowed; opacity: 0.7;">
                          <i class="fa-solid fa-info-circle"></i> ƒê√£ h·ªßy ho·∫°t ƒë·ªông
                      </button>`;
              }

              return `
                  <div class="activity-item">
                      <div class="item-header">
                          <div class="item-title-group">
                              <h3 class="text-xl font-bold" style="color: var(--primary-color); margin: 0; display: inline;">${activity.name}</h3>
                              <span class="item-status ${statusClass}">${statusText}</span>
                          </div>
                      </div>

                      <p class="text-sm" style="color: var(--text-gray); margin-bottom: 15px;">${activity.description}</p>


                      <div class="item-details">
                          <div class="item-detail-box">
                              <i class="fa-solid fa-calendar"></i>
                              <span><b>Ng√†y:</b> ${activity.date}</span>
                          </div>
                          <div class="item-detail-box">
                              <i class="fa-solid fa-map-pin"></i>
                              <span><b>ƒê·ªãa ƒëi·ªÉm:</b> ${activity.location}</span>
                          </div>
                          <div class="item-detail-box">
                              <i class="fa-solid fa-users"></i>
                              <span><b>ƒêƒÉng k√Ω:</b> ${activity.participants}/${activity.maxParticipants} ng∆∞·ªùi</span>
                          </div>
                          <div class="item-detail-box">
                              <i class="fa-solid fa-award"></i>
                              <span><b>ƒê∆°n v·ªã:</b> ${activity.organizer}</span>
                          </div>
                          <div class="item-detail-box">
                              <i class="fa-solid fa-star"></i>
                              <span><b>ƒêi·ªÉm t√≠ch l≈©y:</b> ${activity.score} ƒëi·ªÉm</span>
                          </div>
                      </div>

                      <div class="item-actions">
                          ${actionButtonsHTML}
                      </div>
                  </div>
              `;
          }).join('');

          // 4. Render Modal/Detail View
          if (state.selectedActivity) {
              renderDetailView();
          } else {
              elements.detailView.style.display = 'none';
              elements.activityList.style.display = 'block';
          }
      }

      function renderDetailView() {
          const activity = state.selectedActivity;
          elements.activityList.style.display = 'none';
          elements.detailView.style.display = 'block';

          // L·ªçc sinh vi√™n thu·ªôc ho·∫°t ƒë·ªông hi·ªán t·∫°i
          const participantsInActivity = state.participantsList.filter(p => p.activityId === activity.id);
          
          // Quy·ªÅn duy·ªát: Ch·ªâ c√≥ quy·ªÅn n·∫øu l√† ho·∫°t ƒë·ªông c·ªßa khoa v√† ƒê√É approved
          const canApproveParticipant = activity.type === 'khoa' && activity.status === 'approved';
          const isTruongActivity = activity.type === 'truong';
          
          const scoreDisplay = `<span style="font-size: 1rem; font-weight: 600; color: var(--success-color);">(${activity.score} ƒëi·ªÉm t√≠ch l≈©y)</span>`;

          const tableRows = participantsInActivity.map((p, i) => {
              let pStatusClass, pStatusText;
              switch (p.status) {
                  case 'approved': pStatusClass = 'status-approved'; pStatusText = '‚úì ƒê√£ duy·ªát'; break;
                  case 'rejected': pStatusClass = 'status-rejected'; pStatusText = '‚úó ƒê√£ t·ª´ ch·ªëi'; break;
                  default: pStatusClass = 'status-pending'; pStatusText = '‚è≥ Ch·ªù duy·ªát'; break;
              }

              let actionCell = '';
              if (canApproveParticipant && p.status === 'pending') {
                  // Hi·ªán n√∫t duy·ªát n·∫øu c√≥ quy·ªÅn v√† tr·∫°ng th√°i ƒëang ch·ªù
                  actionCell = `
                      <div class="action-group" style="display:flex; gap:8px;">
                          <button class="btn-approve-sv" style="padding: 5px 10px; background-color: var(--success-color); color: white; border-radius: 6px; border: none; cursor: pointer; font-size: 0.9rem;" onclick="handleApproveParticipant(${p.id})">Duy·ªát</button>
                          <button class="btn-reject-sv" style="padding: 5px 10px; background-color: var(--danger-color); color: white; border-radius: 6px; border: none; cursor: pointer; font-size: 0.9rem;" onclick="handleRejectParticipant(${p.id})">T·ª´ ch·ªëi</button>
                      </div>`;
              } else if (isTruongActivity) {
                  // HO·∫†T ƒê·ªòNG TR∆Ø·ªúNG: KH√îNG HI·ªÜN N√öT DUY·ªÜT SINH VI√äN
                  actionCell = 'Ch·ªâ xem'; 
              }
              
              // Minh ch·ª©ng
              let proofCell = p.proofUrl ? 
                  `<a href="${p.proofUrl}" target="_blank" style="color: var(--primary-color); text-decoration: underline;">Xem (·∫¢nh/File)</a>` 
                  : '<span style="color: var(--danger-color); font-weight: 600;">Kh√¥ng c√≥</span>';

              return `
                  <tr style="border-top: 1px solid #e0e7ff;">
                      <td class="p-2">${i + 1}</td>
                      <td class="p-2 font-semibold">${p.mssv}</td>
                      <td class="p-2">${p.name}</td>
                      <td class="p-2">${p.class}</td>
                      <td class="p-2">${proofCell}</td> <td class="p-2">
                          <span class="item-status ${pStatusClass}" style="padding: 2px 8px;">${pStatusText}</span>
                      </td>
                      <td class="p-2">${actionCell}</td>
                  </tr>
              `;
          }).join('');
          
          // N√∫t Duy·ªát to√†n b·ªô ch·ªâ hi·ªán khi Ho·∫°t ƒë·ªông ƒë√£ ƒë∆∞·ª£c approved
          const approveAllButton = canApproveParticipant ? 
              `<button class="btn-full-approve" onclick="handleApproveActivity(${activity.id})">
                  ‚úì Duy·ªát to√†n b·ªô sinh vi√™n
              </button>` : '';
              
          // ·∫®n n√∫t "Duy·ªát to√†n b·ªô" n·∫øu l√† ho·∫°t ƒë·ªông tr∆∞·ªùng
          const isApproveButtonVisible = canApproveParticipant && !isTruongActivity;


          elements.detailView.innerHTML = `
              <div class="detail-view-header">
                  <h3>${activity.name} ${scoreDisplay}</h3>
                  <button onclick="handleCloseDetail()" style="background: none; border: none; float: right; margin-top: -30px; cursor: pointer; color: var(--text-gray);">
                      <i class="fa-solid fa-xmark fa-lg"></i>
                  </button>
              </div>

              <div style="max-height: 400px; overflow-y: auto;">
                  <table class="participants-table" style="width: 100%;">
                      <thead>
                          <tr>
                              <th style="padding: 10px;">STT</th>
                              <th style="padding: 10px;">MSSV</th>
                              <th style="padding: 10px;">H·ªç t√™n</th>
                              <th style="padding: 10px;">L·ªõp</th>
                              <th style="padding: 10px;">Minh ch·ª©ng</th> <th style="padding: 10px;">Tr·∫°ng th√°i</th>
                              <th style="padding: 10px;">Thao t√°c</th>
                          </tr>
                      </thead>
                      <tbody>
                          ${tableRows}
                      </tbody>
                  </table>
              </div>

              <div class="detail-view-footer">
                  ${isApproveButtonVisible ? approveAllButton : ''}
                  <button class="btn-close" onclick="handleCloseDetail()">
                      ƒê√≥ng
                  </button>
              </div>
          `;
      }

      // ------------------------------------------------
      // üí° CH√ö TH√çCH REACT: Handlers (Logic x·ª≠ l√Ω s·ª± ki·ªán)

      function setActiveTab(tab) {
          state.activeTab = tab;
          state.selectedActivity = null; // ƒê√≥ng modal khi ƒë·ªïi tab
          updateUI();
      }

      function handleViewDetail(activityId) {
          state.selectedActivity = state.activities.find(a => a.id === activityId);
          updateUI();
      }

      function handleCloseDetail() {
          state.selectedActivity = null;
          updateUI();
      }

      // üî¥ LOGIC DUY·ªÜT TO√ÄN B·ªò SINH VI√äN (ƒê√É B·ªî SUNG LOGIC C·ªòNG ƒêI·ªÇM)
      function handleApproveActivity(activityId) {
          const activity = state.activities.find(a => a.id === activityId);
        
          if (activity.status !== 'approved') {
              alert('‚ùå Ho·∫°t ƒë·ªông n√†y ch∆∞a ƒë∆∞·ª£c duy·ªát b·ªüi c·∫•p tr√™n!');
              return;
          }

          const participantsInActivity = state.participantsList.filter(p => p.activityId === activityId);
          const scoreToAdd = activity.score || 0;

          // 1. L·∫•y ra ID c·ªßa T·∫§T C·∫¢ sinh vi√™n ƒëang 'pending' trong ho·∫°t ƒë·ªông n√†y
          const pendingParticipantIds = participantsInActivity
              .filter(p => p.status === 'pending')
              .map(p => p.id);
            
          if (pendingParticipantIds.length === 0) {
              alert('üîî Kh√¥ng c√≥ sinh vi√™n n√†o ƒëang ch·ªù duy·ªát!');
              return;
          }

          let totalScoreAdded = 0;
        
          // 2. C·∫≠p nh·∫≠t tr·∫°ng th√°i v√† C·ªông ƒëi·ªÉm
          state.participantsList = state.participantsList.map(p => {
              if (pendingParticipantIds.includes(p.id)) {
                  // C·ªông ƒëi·ªÉm m√¥ ph·ªèng
                  state.studentScores[p.mssv] = (state.studentScores[p.mssv] || 0) + scoreToAdd;
                  totalScoreAdded++;
                  return {...p, status: 'approved'}; 
              }
              return p;
          });
        
          // 3. Hi·ªán alert th√†nh c√¥ng
          alert(`‚úÖ ƒê√£ duy·ªát to√†n b·ªô ${totalScoreAdded} sinh vi√™n th√†nh c√¥ng v√† c·ªông m·ªói sinh vi√™n ${scoreToAdd} ƒëi·ªÉm!`);
        
          // 4. G·ªçi updateUI() ƒë·ªÉ re-render m√†n h√¨nh chi ti·∫øt (KH√îNG ƒê√ìNG MODAL)
          updateUI(); 
      }

      function handleRejectActivity(activityId) {
          if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë·ªÅ xu·∫•t ho·∫°t ƒë·ªông n√†y?')) {
              state.activities = state.activities.map(a => 
                  a.id === activityId ? {...a, status: 'rejected'} : a
              );
              alert('‚ùå ƒê√£ h·ªßy ƒë·ªÅ xu·∫•t ho·∫°t ƒë·ªông');
              updateUI();
          }
      }

      // üî¥ LOGIC DUY·ªÜT C√Å NH√ÇN (ƒê√É B·ªî SUNG LOGIC C·ªòNG ƒêI·ªÇM)
      function handleApproveParticipant(participantId) {
          const participant = state.participantsList.find(p => p.id === participantId);
          if (!participant || participant.status !== 'pending') { // Ch·ªâ duy·ªát khi ƒëang pending
              alert('üîî Sinh vi√™n n√†y ƒë√£ ƒë∆∞·ª£c duy·ªát/t·ª´ ch·ªëi tr∆∞·ªõc ƒë√≥.');
              return;
          }
        
          const activity = state.activities.find(a => a.id === participant.activityId);
          const scoreToAdd = activity.score || 0; 

          // 1. Logic C·ªông ƒëi·ªÉm: C·∫≠p nh·∫≠t ƒëi·ªÉm t√≠ch l≈©y t·ªïng c·ªßa sinh vi√™n (M√¥ ph·ªèng)
          const mssv = participant.mssv;
          state.studentScores[mssv] = (state.studentScores[mssv] || 0) + scoreToAdd;
          
          // 2. C·∫≠p nh·∫≠t tr·∫°ng th√°i sinh vi√™n
          state.participantsList = state.participantsList.map(p =>
              p.id === participantId ? {...p, status: 'approved'} : p
          );

          alert(`‚úÖ ƒê√£ duy·ªát v√† c·ªông ${scoreToAdd} ƒëi·ªÉm cho sinh vi√™n ${participant.name} (${mssv})! T·ªïng ƒëi·ªÉm hi·ªán t·∫°i (m√¥ ph·ªèng): ${state.studentScores[mssv]}`);
          updateUI();
      }

      function handleRejectParticipant(participantId) {
          state.participantsList = state.participantsList.map(p =>
              p.id === participantId ? {...p, status: 'rejected'} : p
          );
          alert('‚ùå ƒê√£ t·ª´ ch·ªëi sinh vi√™n n√†y.');
          updateUI();
      }

      // ------------------------------------------------
      // üí° CH√ö TH√çCH REACT: ComponentDidMount (G·∫Øn s·ª± ki·ªán)
      function mountDuyetHoatDong() {
          elements.tabKhoa.onclick = () => setActiveTab('khoa');
          elements.tabTruong.onclick = () => setActiveTab('truong');

          // G·∫Øn c√°c h√†m x·ª≠ l√Ω s·ª± ki·ªán v√†o window ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ HTML inline
          window.handleViewDetail = handleViewDetail;
          window.handleCloseDetail = handleCloseDetail;
          window.handleApproveActivity = handleApproveActivity;
          window.handleRejectActivity = handleRejectActivity;
          window.handleApproveParticipant = handleApproveParticipant;
          window.handleRejectParticipant = handleRejectParticipant;

          // Kh·ªüi t·∫°o UI
          updateUI();
      }

      mountDuyetHoatDong();
    </script>
</body>
</html>