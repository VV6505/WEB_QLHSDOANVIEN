<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Ho·∫°t ƒë·ªông - ƒêo√†n tr∆∞·ªùng ƒêH SPKT</title>
        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        
        .header { background: linear-gradient(135deg, #437af2 0%, #1e5ce0 100%); color: white; padding: 20px 40px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .btn-logout { background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid white; padding: 8px 20px; border-radius: 6px; cursor: pointer; transition: all 0.3s; }
        .btn-logout:hover { background: white; color: #e53935; }

        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .toolbar { background: white; padding: 20px 25px; border-radius: 12px 12px 0 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); display: flex; justify-content: space-between; align-items: center; }
        .btn-add { background: linear-gradient(135deg, #5386f5 0%, #2563eb 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .search-box input { padding: 10px 40px 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; width: 300px; }

        .table-container { background: white; border-radius: 0 0 12px 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f8f9fa; }
        th { padding: 18px 15px; text-align: left; font-weight: 600; color: #555; border-bottom: 2px solid #e0e0e0; }
        th:first-child { padding-left: 25px; }
        th:last-child { text-align: center; }
        td { padding: 18px 15px; color: #666; font-size: 14px; border-bottom: 1px solid #f0f0f0; }
        td:first-child { padding-left: 25px; font-weight: 600; color: #333; }
        td:last-child { text-align: center; }

        .badge { display: inline-block; padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-open { background: #e3f2fd; color: #1976d2; }
        .badge-full { background: #ffebee; color: #c62828; }
        .badge-ended { background: #eeeeee; color: #616161; }

        .badge-school { background: #fff8e1; color: #f57f17; border: 1px solid #ffecb3; }
        .badge-faculty { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

        .btn-icon { width: 36px; height: 36px; border: none; border-radius: 6px; cursor: pointer; margin: 0 2px; }
        .btn-edit { background: #4CAF50; color: white; }
        .btn-delete { background: #f44336; color: white; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); }
        .modal-content { background: white; margin: 30px auto; padding: 0; border-radius: 12px; width: 90%; max-width: 700px; }
        .modal-header { background: linear-gradient(135deg, #e53935 0%, #c62828 100%); color: white; padding: 20px 25px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; background: #f9f9f9; border-radius: 0 0 12px 12px; display: flex; justify-content: flex-end; gap: 10px; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .full-width { grid-column: span 2; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
        
        .progress-mini { width: 60px; height: 6px; background: #f0f0f0; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .progress-mini-fill { height: 100%; background: #4CAF50; }
        .note { font-size: 0.8rem; color: #666; margin-top: 4px; font-style: italic; }

        .desc-cell {
            max-width: 200px;
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            font-style: italic;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üéì Qu·∫£n l√Ω Ho·∫°t ƒë·ªông ƒêo√†n</h1>
            <div class="user-info">
                <span>Xin ch√†o, <strong>ƒêo√†n Tr∆∞·ªùng</strong></span>
                <button class="btn-logout" onclick="window.location.href='pageLogin.html'">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="btn-add" onclick="openModal('add')">
                    <span>‚ûï</span> <span>Th√™m ho·∫°t ƒë·ªông</span>
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm ho·∫°t ƒë·ªông, ƒë∆°n v·ªã..." onkeyup="searchActivities()">
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>T√™n ho·∫°t ƒë·ªông</th>
                        <th>C·∫•p t·ªï ch·ª©c</th>
                        <th>M√¥ t·∫£</th> <th>Ng√†y t·ªï ch·ª©c</th>
                        <th>ƒêƒÉng k√Ω / Max</th>
                        <th>ƒêi·ªÉm</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Th√™m ho·∫°t ƒë·ªông</h2>
                <span style="cursor:pointer; font-weight:bold; color:white; font-size:24px" onclick="closeModal()">‚úï</span>
            </div>
            <div class="modal-body">
                <form id="activityForm">
                    <input type="hidden" id="_idHD">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>T√™n ho·∫°t ƒë·ªông (tenHD) <span style="color:red">*</span></label>
                            <input type="text" id="tenHD" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Ph·∫°m vi / M√£ Khoa (maKhoa)</label>
                            <select id="maKhoa" onchange="autoFillDonVi()">
                                <option value="">-- C·∫•p ƒêo√†n tr∆∞·ªùng (M·∫∑c ƒë·ªãnh) --</option>
                                <option value="CNTT">Khoa CNTT</option>
                                <option value="CK">Khoa C∆° kh√≠</option>
                                <option value="KT">Khoa Kinh t·∫ø</option>
                                <option value="DIEN">Khoa ƒêi·ªán - ƒêi·ªán t·ª≠</option>
                                <option value="XAYDUNG">Khoa X√¢y d·ª±ng</option>
                            </select>
                            <p class="note">* ƒê·ªÉ tr·ªëng = Ho·∫°t ƒë·ªông ƒêo√†n tr∆∞·ªùng</p>
                        </div>

                        <div class="form-group">
                            <label>ƒê∆°n v·ªã t·ªï ch·ª©c (donViToChuc)</label>
                            <input type="text" id="donViToChuc" placeholder="V√≠ d·ª•: ƒêo√†n tr∆∞·ªùng, LCƒê...">
                        </div>

                        <div class="form-group">
                            <label>Ng√†y t·ªï ch·ª©c (ngayToChuc) <span style="color:red">*</span></label>
                            <input type="datetime-local" id="ngayToChuc" required>
                        </div>

                        <div class="form-group">
                            <label>ƒê·ªãa ƒëi·ªÉm (diaDiem) <span style="color:red">*</span></label>
                            <input type="text" id="diaDiem" required>
                        </div>

                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£ng t·ªëi ƒëa <span style="color:red">*</span></label>
                            <input type="number" id="soLuongMAX" min="1" max="130" required placeholder="Nh·∫≠p t·ªëi ƒëa 130">
                        </div>

                        <div class="form-group">
                            <label>ƒêi·ªÉm ho·∫°t ƒë·ªông (Max 10)</label>
                            <input type="number" id="diemHoatDong" min="0" max="10" value="0">
                        </div>

                        <div class="form-group">
                            <label>ƒê√£ ƒëƒÉng k√Ω (soLuongDaDK)</label>
                            <input type="number" id="soLuongDaDK" value="0" disabled style="background:#f0f0f0">
                        </div>
                        <div class="form-group">
                            <label>Tr·∫°ng th√°i (trangThaiHD)</label>
                            <input type="text" id="trangThaiHD" value="ƒêang m·ªü" disabled style="background:#f0f0f0">
                        </div>

                        <div class="form-group full-width">
                            <label>M√¥ t·∫£ ho·∫°t ƒë·ªông (moTa)</label>
                            <textarea id="moTa" rows="3" placeholder="Nh·∫≠p n·ªôi dung chi ti·∫øt ho·∫°t ƒë·ªông..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" style="padding:10px 20px; border:none; border-radius:4px; cursor:pointer">H·ªßy</button>
                <button onclick="saveActivity()" style="padding:10px 20px; border:none; border-radius:4px; cursor:pointer; background:#e53935; color:white">L∆∞u</button>
            </div>
        </div>
    </div>

    <script>
        // === D·ªÆ LI·ªÜU M·∫™U C√ì M√î T·∫¢ ƒê·∫¶Y ƒê·ª¶ ===
        let activities = [
            {
                _idHD: 'HD001',
                tenHD: 'Ra qu√¢n M√πa h√® xanh 2025',
                maKhoa: null, 
                donViToChuc: 'ƒêo√†n tr∆∞·ªùng',
                ngayToChuc: '2025-06-15T07:00',
                diaDiem: 'S√¢n C·ªôt C·ªù',
                soLuongMAX: 130, 
                soLuongDaDK: 115,
                diemHoatDong: 10,
                trangThaiHD: 'ƒêang m·ªü',
                moTa: 'Chi·∫øn d·ªãch t√¨nh nguy·ªán h·ªó tr·ª£ v√πng s√¢u v√πng xa, x√¢y d·ª±ng n√¥ng th√¥n m·ªõi v√† gi√∫p ƒë·ª° tr·∫ª em ngh√®o.'
            },
            {
                _idHD: 'HD002',
                tenHD: 'Workshop: AI & ChatGPT',
                maKhoa: 'CNTT', 
                donViToChuc: 'LCƒê Khoa CNTT',
                ngayToChuc: '2025-04-10T08:00',
                diaDiem: 'H·ªôi tr∆∞·ªùng F',
                soLuongMAX: 100,
                soLuongDaDK: 100, 
                diemHoatDong: 5,
                trangThaiHD: 'ƒê√£ ƒë·ªß s·ªë l∆∞·ª£ng',
                moTa: 'H·ªôi th·∫£o chuy√™n ƒë·ªÅ v·ªÅ ·ª©ng d·ª•ng Tr√≠ tu·ªá nh√¢n t·∫°o trong h·ªçc t·∫≠p v√† nghi√™n c·ª©u khoa h·ªçc.'
            },
            {
                _idHD: 'HD003',
                tenHD: 'Cu·ªôc thi: √ù t∆∞·ªüng Kh·ªüi nghi·ªáp',
                maKhoa: 'KT',
                donViToChuc: 'LCƒê Khoa Kinh t·∫ø',
                ngayToChuc: '2025-05-20T13:30',
                diaDiem: 'Ph√≤ng A3-202',
                soLuongMAX: 60,
                soLuongDaDK: 25,
                diemHoatDong: 8,
                trangThaiHD: 'ƒêang m·ªü',
                moTa: 'T√¨m ki·∫øm c√°c √Ω t∆∞·ªüng kinh doanh s√°ng t·∫°o t·ª´ sinh vi√™n, k·∫øt n·ªëi v·ªõi c√°c doanh nghi·ªáp.'
            },
            {
                _idHD: 'HD004',
                tenHD: 'Gi·∫£i B√≥ng ƒë√° Nam Sinh vi√™n',
                maKhoa: null, 
                donViToChuc: 'ƒêo√†n tr∆∞·ªùng',
                ngayToChuc: '2025-01-15T15:00',
                diaDiem: 'S√¢n v·∫≠n ƒë·ªông',
                soLuongMAX: 130,
                soLuongDaDK: 130,
                diemHoatDong: 5,
                trangThaiHD: 'ƒê√£ k·∫øt th√∫c',
                moTa: 'Gi·∫£i b√≥ng ƒë√° th∆∞·ªùng ni√™n nh·∫±m n√¢ng cao tinh th·∫ßn th·ªÉ thao v√† ƒëo√†n k·∫øt.'
            },
            {
                _idHD: 'HD005',
                tenHD: 'Robocon c·∫•p tr∆∞·ªùng 2025',
                maKhoa: 'DIEN',
                donViToChuc: 'LCƒê Khoa ƒêi·ªán - ƒêi·ªán t·ª≠',
                ngayToChuc: '2025-08-05T08:00',
                diaDiem: 'Nh√† thi ƒë·∫•u ƒêa nƒÉng',
                soLuongMAX: 80,
                soLuongDaDK: 45,
                diemHoatDong: 9,
                trangThaiHD: 'ƒêang m·ªü',
                moTa: 'Cu·ªôc thi s√°ng t·∫°o robot d√†nh cho sinh vi√™n ƒëam m√™ k·ªπ thu·∫≠t v√† t·ª± ƒë·ªông h√≥a.'
            },
            {
                _idHD: 'HD006',
                tenHD: 'T·∫≠p hu·∫•n C√°n b·ªô ƒêo√†n',
                maKhoa: null,
                donViToChuc: 'ƒêo√†n tr∆∞·ªùng',
                ngayToChuc: '2025-03-26T07:30',
                diaDiem: 'Ph√≤ng h·ªçp s·ªë 1',
                soLuongMAX: 50,
                soLuongDaDK: 50,
                diemHoatDong: 7,
                trangThaiHD: 'ƒê√£ ƒë·ªß s·ªë l∆∞·ª£ng',
                moTa: 'Ch∆∞∆°ng tr√¨nh b·ªìi d∆∞·ª°ng k·ªπ nƒÉng nghi·ªáp v·ª• cho c√°n b·ªô ƒêo√†n c√°c c·∫•p.'
            },
            {
                _idHD: 'HD007',
                tenHD: 'Thi·∫øt k·∫ø b·∫£n v·∫Ω k·ªπ thu·∫≠t',
                maKhoa: 'CK',
                donViToChuc: 'LCƒê Khoa C∆° kh√≠',
                ngayToChuc: '2025-09-10T09:00',
                diaDiem: 'Ph√≤ng m√°y C',
                soLuongMAX: 40,
                soLuongDaDK: 12,
                diemHoatDong: 4,
                trangThaiHD: 'ƒêang m·ªü',
                moTa: 'Cu·ªôc thi k·ªπ nƒÉng s·ª≠ d·ª•ng AutoCAD v√† SolidWorks cho sinh vi√™n C∆° kh√≠.'
            }
        ];

        let currentMode = 'add';
        let editingId = null;

        function renderTable(data = activities) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" style="text-align:center; padding:30px">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</td></tr>`;
                return;
            }

            data.forEach(item => {
                let capToChucHTML = '';
                if (item.maKhoa === null || item.maKhoa === "") {
                    capToChucHTML = `<span class="badge badge-school">üî¥ ƒêo√†n tr∆∞·ªùng</span>`;
                } else {
                    capToChucHTML = `<span class="badge badge-faculty">Khoa: ${item.maKhoa}</span>`;
                }

                let badgeClass = 'badge-ended';
                if(item.trangThaiHD === 'ƒêang m·ªü') badgeClass = 'badge-open';
                if(item.trangThaiHD === 'ƒê√£ ƒë·ªß s·ªë l∆∞·ª£ng') badgeClass = 'badge-full';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <div style="font-weight:bold">${item.tenHD}</div>
                        <small style="color:#888">${item._idHD}</small>
                    </td>
                    <td>${capToChucHTML}</td>
                    <td class="desc-cell" title="${item.moTa || 'Kh√¥ng c√≥ m√¥ t·∫£'}">
                        ${item.moTa || '<i>(Tr·ªëng)</i>'}
                    </td>
                    <td>${new Date(item.ngayToChuc).toLocaleString('vi-VN')}</td>
                    <td>
                        <div>${item.soLuongDaDK} / ${item.soLuongMAX}</div>
                        <div class="progress-mini">
                            <div class="progress-mini-fill" style="width: ${(item.soLuongDaDK/item.soLuongMAX)*100}%"></div>
                        </div>
                    </td>
                    <td style="font-weight:bold; color:#e53935; text-align:center">${item.diemHoatDong}</td>
                    <td><span class="badge ${badgeClass}">${item.trangThaiHD}</span></td>
                    <td>
                        <button class="btn-icon btn-edit" onclick="editActivity('${item._idHD}')">‚úèÔ∏è</button>
                        <button class="btn-icon btn-delete" onclick="deleteActivity('${item._idHD}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function autoFillDonVi() {
            const maKhoa = document.getElementById('maKhoa').value;
            const donViInput = document.getElementById('donViToChuc');
            if (maKhoa === "") {
                donViInput.value = "ƒêo√†n tr∆∞·ªùng";
            } else {
                donViInput.value = `LCƒê Khoa ${maKhoa}`;
            }
        }

        function openModal(mode, id = null) {
            currentMode = mode;
            const modal = document.getElementById('activityModal');
            document.getElementById('activityForm').reset();

            if (mode === 'add') {
                document.getElementById('modalTitle').innerText = 'Th√™m ho·∫°t ƒë·ªông m·ªõi';
                document.getElementById('soLuongDaDK').value = 0;
                document.getElementById('trangThaiHD').value = 'ƒêang m·ªü';
                document.getElementById('maKhoa').value = "";
                document.getElementById('donViToChuc').value = "ƒêo√†n tr∆∞·ªùng";
            } else {
                document.getElementById('modalTitle').innerText = 'C·∫≠p nh·∫≠t ho·∫°t ƒë·ªông';
                const item = activities.find(x => x._idHD === id);
                editingId = id;

                document.getElementById('_idHD').value = item._idHD;
                document.getElementById('tenHD').value = item.tenHD;
                document.getElementById('maKhoa').value = item.maKhoa === null ? "" : item.maKhoa; 
                document.getElementById('donViToChuc').value = item.donViToChuc;
                document.getElementById('ngayToChuc').value = item.ngayToChuc;
                document.getElementById('diaDiem').value = item.diaDiem;
                document.getElementById('soLuongMAX').value = item.soLuongMAX;
                document.getElementById('diemHoatDong').value = item.diemHoatDong;
                document.getElementById('soLuongDaDK').value = item.soLuongDaDK;
                document.getElementById('trangThaiHD').value = item.trangThaiHD;
                document.getElementById('moTa').value = item.moTa || "";
            }
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('activityModal').style.display = 'none';
        }

        function saveActivity() {
            const tenHD = document.getElementById('tenHD').value;
            let maKhoa = document.getElementById('maKhoa').value;
            if (maKhoa === "") maKhoa = null; 

            const donViToChuc = document.getElementById('donViToChuc').value;
            const ngayToChuc = document.getElementById('ngayToChuc').value;
            const diaDiem = document.getElementById('diaDiem').value;
            const soLuongMAX = parseInt(document.getElementById('soLuongMAX').value);
            const diemHoatDong = parseInt(document.getElementById('diemHoatDong').value);
            const moTa = document.getElementById('moTa').value;

            if (!tenHD || !ngayToChuc || !soLuongMAX) {
                alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
                return;
            }

            if (soLuongMAX > 130) {
                alert("‚ö†Ô∏è L·ªói: S·ªë l∆∞·ª£ng t·ªëi ƒëa kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 130 sinh vi√™n!");
                document.getElementById('soLuongMAX').value = 130;
                return;
            }

            if (diemHoatDong > 10) {
                alert("‚ö†Ô∏è L·ªói: ƒêi·ªÉm ho·∫°t ƒë·ªông t·ªëi ƒëa l√† 10 ƒëi·ªÉm!");
                document.getElementById('diemHoatDong').value = 10;
                return;
            }

            const soLuongDaDK = currentMode === 'add' ? 0 : parseInt(document.getElementById('soLuongDaDK').value);
            let trangThaiHD = 'ƒêang m·ªü';
            if (soLuongDaDK >= soLuongMAX) trangThaiHD = 'ƒê√£ ƒë·ªß s·ªë l∆∞·ª£ng';

            if (currentMode === 'add') {
                const newId = 'HD' + Date.now().toString().slice(-4);
                activities.unshift({
                    _idHD: newId,
                    tenHD, maKhoa, donViToChuc, ngayToChuc, diaDiem,
                    soLuongMAX, soLuongDaDK, diemHoatDong, trangThaiHD, moTa
                });
            } else {
                const idx = activities.findIndex(x => x._idHD === editingId);
                if (idx !== -1) {
                    activities[idx] = {
                        ...activities[idx],
                        tenHD, maKhoa, donViToChuc, ngayToChuc, diaDiem,
                        soLuongMAX, diemHoatDong, trangThaiHD, moTa
                    };
                }
            }
            closeModal();
            renderTable();
        }

        function deleteActivity(id) {
            if(confirm("X√≥a ho·∫°t ƒë·ªông n√†y?")) {
                activities = activities.filter(x => x._idHD !== id);
                renderTable();
            }
        }

        function editActivity(id) {
            openModal('edit', id);
        }
        
        function searchActivities() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = activities.filter(a => 
                a.tenHD.toLowerCase().includes(term) || 
                a.donViToChuc.toLowerCase().includes(term)
            );
            renderTable(filtered);
        }

        renderTable();
    </script>
</body>
</html>